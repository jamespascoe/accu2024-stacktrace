<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Advanced Usage of the C++23 Stacktrace Library</title>

    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico?">

    <link rel="stylesheet" href="dist/reset.css">
    <link rel="stylesheet" href="dist/reveal.css">
    <link rel="stylesheet" href="dist/theme/league.css" id="theme">

    <!-- Theme used for syntax highlighted code -->
    <link rel="stylesheet" href="plugin/highlight/github.css" id="highlight-theme">

  </head>
  <body>
    <div class="reveal">
      <div class="slides">

<!--
        <section id="Title-Slide"
                 data-state="hideControls"
                 data-menu-title="Title Slide"
                 data-background-image="media/title-slide.png"
                 data-background-size="contain">
        </section>
-->

        <section data-menu-title="Overview">
          <h2>Advanced Usage of the C++23 Stacktrace Library</h2>
            <p>
            <h4>(Stacktraces and How to Use Them)</h4>
            <small>
              Jim (James) Pascoe<br>
              <a href="http://www.james-pascoe.com">http://www.james-pascoe.com</a><br>
              <a href="mailto:james@james-pascoe.com">james@james-pascoe.com</a><p>

              <a href="http://jamespascoe.github.io/accu2024-stacktrace">http://jamespascoe.github.io/accu2024-stacktrace</a>
              <p>
              <font style="color:yellow">ACCU Bristol and Bath Meetup Coordinator</font>
            </small>
          <aside class="notes">
          Hello, good afternoon and welcome - my name is Jim Pascoe and today I am going to talk to you about the C++23 Stacktrace
          library and why its really useful.
          <p>
          Here is my email address and URL (if you want to find out a bit about what I've done in the past) and also, this
          is the link to the online talk, so you can follow along from the comfort of your own browser if you prefer. So,
          you can use the hamburger icon to skip between the slides and select a light theme if you prefer.
          </aside>
        </section>

        <section data-menu-title="Stacktraces">
          <h3 style="color:yellow">Stacktraces, tracebacks, call sequences</h3>
          <ul>
            <span class="fragment"><li>Locate problems without a debugger</li></span>
            <span class="fragment"><ul><li>assertions, exceptions, post mortem</li></ul></span>
            <span class="fragment"><li>Analyse performance</li></span>
            <span class="fragment"><ul><li>buffer stacktraces </span><span class="fragment">(combine with metrics)</span></li></ul></span>
            <span class="fragment"><li>Prior to C++23, no standard stacktraces</li></span>
            <span class="fragment">
              <ul>
                <li>
                  <a href="https://www.gnu.org/software/libc/manual/html_node/Backtraces.html">backtrace</a>, 
                  <a href="https://www.nongnu.org/libunwind/">libunwind</a>, 
                  <a href="https://www.commandlinux.com/man-page/man1/catchsegv.1.html">catchsegv</a>
                </li>
              </ul>
            </span>
            <span class="fragment"><li><a href="https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2020/p0881r7.html">P0881R7: A Proposal to Add A Stacktrace Library</a></li></span>
            <span class="fragment"><ul><li>based on <a href="https://www.boost.org/doc/libs/master/doc/html/stacktrace.html">Boost::Stacktrace</a></li></ul></span>
          </ul>
          <aside class="notes">
            Backtrace (glibc), libunwind (LLVM), catchsegv (Linux)
          </aside>
        </section>

        <section data-menu-title="Example">
          <h2><a href="https://github.com/jamespascoe/accu2024-example-code/blob/master/stacktrace.cpp">Getting Started</a></h2>
          <pre><code class="c++" data-trim data-line-numbers="|5|">
#include &ltstacktrace&gt
#include &ltiostream&gt

void foo() {
    auto trace = std::stacktrace::current();
    std::cout &lt&lt std::to_string(trace) &lt&lt '\n';
}

int main(void)
{
  foo();
}
          </code></pre>
          <aside class="notes">
            - Code snippet
            - Mention github (materials) - CMake
            - Toolchain support
          </aside>
        </section>

<!--

  5. Output

    - Show output (could combine with previous slide)
    - Compiler options matter:
     - -O0 -g -rdynamic

  5. GDB Demo Video

    - Show video and discuss
    - Point out that libc refers to the C standard library and glibc is an implementation of libc
    - Tip: Provide link to GDB console

  6. API Overview

    - How to save stacktraces for later
    - How do we use stacktraces for catching segfaults
    - What about multi-threading and re-entrancy
-->

        <section>
          <h2 style="color:yellow">Async Signal Safety</h2>
          <ul>
            <span class="fragment"><li>Can I use <a href="">std::stacktrace</a> in a signal handler?</li>
            <span class="fragment"><li>Not currently, but the design is extensible</li>
            <span class="fragment"><li>Custom allocators and lazy trace frames</li>
            <span class="fragment"><li>Consider using <a href="https://www.boost.org/doc/libs/1_84_0/doc/html/stacktrace/reference.html#header.boost.stacktrace.safe_dump_to_hpp">Boost:stacktrace::safe_dump_to</a></li>
            <span class="fragment"><li><a href="https://man7.org/linux/man-pages/man7/signal-safety.7.html">signal-safety(7) — Linux manual page</a></li>
          </ul>
          <aside class="notes">
          As a general rule of thumb, nonrentrant functions are generally unsafe to call from signal handlers.
          Do you need to record the whole stack?
          </aside>
        </section>

        <section>
          <h2 style="color:yellow">Resources</h2>
          <ul>
            <span class="fragment"><li><a href="https://youtu.be/9IcxniCxKlQ?si=GtuMOVHm8wzRvv56">C++23's Awesome std::stacktrace Library</a></li>
            <span class="fragment"><ul><li>C++ Weekly (Jason Turner)</li></ul></span>
            <span class="fragment"><li><a href="https://www.sandordargo.com/blog/2022/09/21/cpp23-stacktrace-library">C++23: The Stacktrace Library</a></li>
            <span class="fragment"><ul><li>Sandor Dargo's Blog</li></ul></span>
            <span class="fragment"><li><a href="https://www.boost.org/doc/libs/master/doc/html/stacktrace.html">Boost::Stacktrace Documentation</a></li>
            <span class="fragment"><li><a href="https://man7.org/linux/man-pages/man7/signal-safety.7.html">signal-safety(7) — Linux manual page</a></li>
            <span class="fragment"><li><a href="https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2020/p0881r7.html">P0881R7: A Proposal to Add A Stacktrace Library</a></li>
          </ul>
          <aside class="notes">
          </aside>
        </section>

        <section>
          <h2>Questions?</h2>
          <p><p>
          <a href="http://www.james-pascoe.com">http://www.james-pascoe.com</a><br>
          <a href="mailto:james@james-pascoe.com">james@james-pascoe.com</a><p>

          <a href="http://jamespascoe.github.io/accu2024-stacktrace">http://jamespascoe.github.io/accu2024-stacktrace</a>
          <p>
          <font style="color:yellow">ACCU Bristol and Bath Meetup Coordinator</font>
        </section>

        </section>
      </div>
    </div>

    <script src="dist/reveal.js"></script>
    <script src="plugin/notes/notes.js"></script>
    <script src="plugin/markdown/markdown.js"></script>
    <script src="plugin/highlight/highlight.js"></script>
    <script src="plugin/menu/menu.js"></script>
    <script src="plugin/chart/Chart.min.js"></script>
    <script src="plugin/chart/plugin.js"></script>
    <script src="plugin/animated/revealjs-animated.js"></script>
    <script>
      // More info about initialization & config:
      // - https://revealjs.com/initialization/
      // - https://revealjs.com/config/
      Reveal.initialize({
        hash: true,
        controls: true,
        totalTime: 1200,
        hideInactiveCursor: true,
        hideCursorTime: 2000,
        hideAddressBar: true,
        preloadIframes: true,
        progress: false,
        touch: true,
        pdfMaxPagesPerSlide: 1,
        keyboard: {
          67: () => { /* Keycode for the letter 'c' i.e. 'controls' */
            var currentSlide = Reveal.getCurrentSlide();
            var currentVideo = currentSlide.slideBackgroundContentElement.getElementsByTagName("video")[0];
            if (currentVideo) {
              /* Toggle video controls on/off */
              currentVideo.controls = !currentVideo.controls
            }
          },
          32: () => { /* Keycode for spacebar */
            var currentSlide = Reveal.getCurrentSlide();
            var currentVideo = currentSlide.slideBackgroundContentElement.getElementsByTagName("video")[0];
            if (currentVideo) {
              /* Pause/resume video when the spacebar is pressed */
              if (currentVideo.paused == true) currentVideo.play();
              else currentVideo.pause();
            }
            else {
              /* Advance to next slide if no video (default Reveal behaviour) */
              Reveal.next();
            }
          }
        },
        chart: {
          defaults: {
            global: {
              title: { fontColor: "#FFF" },
              legend: {
                position: "bottom",
                labels: { fontColor: "#FFF" },
              },
              tooltips: {
                labels: { fontColor: "#FFF" },
              },
            },
            scale: {
              scaleLabel: { fontColor: "#FFF" },
              gridLines: { color: "#FFF", zeroLineColor: "#FFF" },
              ticks: { fontColor: "#FFF" },
            }
          },
          bar: { backgroundColor: [ "rgba(20,220,220,.8)" , "rgba(220,120,120,.8)", "rgba(20,120,220,.8)", "rgba(255, 159, 64, .8)","rgba(255, 205, 86, .8)", "rgba(153, 102, 255, .8)" ]},
        },
        menu: {
          themes: true,
          delayInit: true
        },
        pdfSeparateFragments: false,
        // Learn about plugins: https://revealjs.com/plugins/
        plugins: [ RevealMarkdown, RevealHighlight, RevealNotes, RevealMenu, RevealChart ]
      });

      Reveal.addEventListener('hideControls', function() {
        Reveal.configure({controls: false});
        menu_button = document.getElementsByClassName("slide-menu-button")[0];
        if (menu_button) {
          menu_button.style.display = 'none';
        }
      }, false );

      Reveal.addEventListener('slidechanged', function() {
        /* Ensure that the Reveal controls and Menu are available on
         * all slides other than the 'Title-Slide'.
         */
        slide_id = Reveal.getCurrentSlide().getAttribute("id");

        if (slide_id !== "Title-Slide" && slide_id !== "video") {
          config = Reveal.getConfig();
          if (config["controls"] !== true) {
            Reveal.configure({controls: true});
          }

          menu = Reveal.getPlugin("menu");
          if (!menu.isMenuInitialised()) {
            menu.initialiseMenu();
          }
          menu_button = document.getElementsByClassName("slide-menu-button")[0];
          if (menu_button) {
            menu_button.style.display = '';
          }
        }
      }, false );
   </script>
  </body>
</html>
